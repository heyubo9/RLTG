if [ ! -d "./libming-CVE-2018-8962" ]; then
    git clone https://github.com/libming/libming.git libming-CVE-2018-8962

fi
if [ -d "./libming-CVE-2018-8962" ]; then
    cd libming-CVE-2018-8962/; #git checkout b72cc2f # version 0.4.8
    if [ -d "./obj-aflgo" ]; then
        cd obj-aflgo;rm -rf out
        export TMP_DIR=$PWD/temp
        $AFLGO/afl-fuzz -d -m none -z exp -c 45m -D $TMP_DIR -U -i in -o out ./util/swftophp @@
    else
        mkdir obj-aflgo; mkdir obj-aflgo/temp
        export SUBJECT=$PWD; export TMP_DIR=$PWD/obj-aflgo/temp
        export SVF_DIR=$AFLGO/SVF/Release-build/bin
        export CC=$AFLGO/afl-clang-fast; export CXX=$AFLGO/afl-clang-fast++
        export LDFLAGS=-lpthread
        export ADDITIONAL="-targets=$TMP_DIR/BBtargets.txt -outdir=$TMP_DIR -flto -fuse-ld=gold -Wl,-plugin-opt=save-temps"
        echo $'decompile.c:398' > $TMP_DIR/BBtargets.txt
        ./autogen.sh;
        cd obj-aflgo; CFLAGS="$ADDITIONAL" CXXFLAGS="$ADDITIONAL" ../configure --disable-shared --prefix=`pwd` --disable-freetype
        make clean; make
        cat $TMP_DIR/BBnames.txt | sort | uniq > $TMP_DIR/BBnames2.txt && mv $TMP_DIR/BBnames2.txt $TMP_DIR/BBnames.txt
        cat $TMP_DIR/BBcalls.txt | sort | uniq > $TMP_DIR/BBcalls2.txt && mv $TMP_DIR/BBcalls2.txt $TMP_DIR/BBcalls.txt
        #extract indirect call
        $SVF_DIR/wpa --print-fp --ander $SUBJECT/obj-aflgo/util/swftophp.0.0.preopt.bc >> $TMP_DIR/indirect.txt
        $AFLGO/scripts/ex_incallsite.sh $TMP_DIR/indirect.txt $TMP_DIR

        cd util; $AFLGO/scripts/gen_distance_fast.py -p $PWD $TMP_DIR swftophp

        # cd -; CFLAGS="-distance=$TMP_DIR/distance.cfg.txt" CXXFLAGS="-distance=$TMP_DIR/distance.cfg.txt" ../configure --disable-shared --prefix=`pwd`
        # make clean; make
        cd -;
        mkdir in; wget -P in http://condor.depaul.edu/sjost/hci430/flash-examples/swf/bumble-bee1.swf
        $AFLGO/afl-fuzz -d -m none -z exp -c 45m -D $TMP_DIR -U -i in -o out ./util/swftophp @@
    fi
fi