if [ ! -d CVE-2017-8392 ];then
    git clone git://sourceware.org/git/binutils-gdb.git CVE-2017-8392
fi
cd CVE-2017-8392
if [ -d obj-aflgo ];then

    cd obj-aflgo; rm -rf ./out
    export TMP_DIR=$PWD/temp

    $AFLGO/afl-fuzz -m none -z exp -c 45m -U -D $TMP_DIR -i in -o out binutils/objdump -SD @@
else
    #git checkout a6c21d4a553de184562fd8409a5bcd3f2cc2561a
    mkdir obj-aflgo; mkdir obj-aflgo/temp
    export SUBJECT=$PWD; export TMP_DIR=$PWD/obj-aflgo/temp
    export SVF_DIR=$AFLGO/SVF/Release-build/bin
    export CC=$AFLGO/afl-clang-fast; export CXX=$AFLGO/afl-clang-fast++
    export LDFLAGS=-lpthread
    export ADDITIONAL="-targets=$TMP_DIR/BBtargets.txt -outdir=$TMP_DIR -flto -fuse-ld=gold -Wl,-plugin-opt=save-temps"
    # echo $'dwarf2.c:4212' > $TMP_DIR/BBtargets.txt
    # cd obj-aflgo
    # CFLAGS="-DFORTIFY_SOURCE=2 -fstack-protector-all -fno-omit-frame-pointer -g -Wno-error $ADDITIONAL" LDFLAGS="-ldl -lutil" ../configure --disable-shared --disable-gdb --disable-libdecnumber --disable-readline --disable-sim --disable-ld
    # make clean; make

    # $SVF_DIR/wpa --print-fp --ander $SUBJECT/obj-aflgo/binutils/objdump.0.0.preopt.bc >> $TMP_DIR/indirect.txt
    # $AFLGO/scripts/ex_incallsite.sh $TMP_DIR/indirect.txt $TMP_DIR

    # cat $TMP_DIR/BBnames.txt  | sort | uniq > $TMP_DIR/BBnames2.txt && mv $TMP_DIR/BBnames2.txt $TMP_DIR/BBnames.txt
    # cat $TMP_DIR/BBcalls.txt | sort | uniq > $TMP_DIR/BBcalls2.txt && mv $TMP_DIR/BBcalls2.txt $TMP_DIR/BBcalls.txt
    # cat $TMP_DIR/BBinCalls.txt | sort | uniq > $TMP_DIR/BBinCalls2.txt && mv $TMP_DIR/BBinCalls2.txt $TMP_DIR/BBinCalls.txt

    cd binutils; $AFLGO/scripts/gen_distance_fast.py -p $PWD $TMP_DIR objdump
    # cd binutils; $AFLGO/scripts/genDistance.sh $SUBJECT $TMP_DIR objdump -SD @@
    cd -;
    mkdir in; echo "" > in/in
    $AFLGO/afl-fuzz -m none -z exp -c 45m -U -D $TMP_DIR -i in -o out binutils/objdump -SD @@
fi
